<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electric Current Flow - Interactive Physics</title>
    <link rel="stylesheet" href="parallax-style.css">
    <style>
        /* Enhanced Educational Illustration Styles */
        :root {
            --electron-color: #74b9ff;
            --wire-color: #ffeaa7;
            --current-color: #e17055;
            --voltage-color: #00b894;
            --copper-color: #d63031;
        }

        .illustration-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            color: white;
        }

        .concept-section {
            margin: 60px 0;
            background: rgba(0, 5, 17, 0.8);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(74, 158, 255, 0.3);
            backdrop-filter: blur(15px);
        }

        .section-title {
            font-size: 2.5rem;
            color: #4a9eff;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #4a9eff, #74b9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Wire and Current Flow Visualization */
        .wire-container {
            position: relative;
            width: 100%;
            height: 120px;
            margin: 30px 0;
            background: linear-gradient(90deg, 
                rgba(255, 234, 167, 0.3) 0%, 
                rgba(255, 234, 167, 0.6) 50%, 
                rgba(255, 234, 167, 0.3) 100%);
            border-radius: 60px;
            border: 3px solid var(--wire-color);
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 234, 167, 0.4);
        }

        .electron {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, var(--electron-color), #0984e3);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 15px rgba(116, 185, 255, 0.8);
            animation: electronFlow 4s linear infinite;
        }

        @keyframes electronFlow {
            0% { left: -20px; }
            100% { left: calc(100% + 20px); }
        }

        .electron:nth-child(1) { animation-delay: 0s; }
        .electron:nth-child(2) { animation-delay: 0.5s; }
        .electron:nth-child(3) { animation-delay: 1s; }
        .electron:nth-child(4) { animation-delay: 1.5s; }
        .electron:nth-child(5) { animation-delay: 2s; }
        .electron:nth-child(6) { animation-delay: 2.5s; }
        .electron:nth-child(7) { animation-delay: 3s; }
        .electron:nth-child(8) { animation-delay: 3.5s; }

        /* Current Direction Arrows */
        .current-arrow {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: var(--current-color);
            animation: currentPulse 2s ease-in-out infinite;
        }

        @keyframes currentPulse {
            0%, 100% { opacity: 0.6; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        .direction-label {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(225, 112, 85, 0.9);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Circuit Visualization */
        .circuit-container {
            position: relative;
            width: 500px;
            height: 300px;
            margin: 30px auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
        }

        .circuit-wire {
            position: absolute;
            background: var(--wire-color);
            border-radius: 3px;
        }

        .horizontal-wire {
            height: 6px;
            width: 200px;
        }

        .vertical-wire {
            width: 6px;
            height: 100px;
        }

        .battery {
            position: absolute;
            width: 60px;
            height: 30px;
            background: linear-gradient(90deg, #2d3436, #636e72);
            border-radius: 5px;
            left: 50px;
            top: 135px;
            border: 2px solid #74b9ff;
        }

        .battery::before {
            content: '+';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            color: #e17055;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .battery::after {
            content: '−';
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            color: #74b9ff;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .resistor {
            position: absolute;
            width: 40px;
            height: 20px;
            background: linear-gradient(45deg, #d63031, #e84393);
            border-radius: 3px;
            left: 350px;
            top: 140px;
            border: 2px solid #fd79a8;
        }

        /* Current Flow in Circuit */
        .circuit-electron {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--electron-color);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(116, 185, 255, 0.8);
        }

        .circuit-electron.path1 {
            animation: circuitFlow1 6s linear infinite;
        }

        .circuit-electron.path2 {
            animation: circuitFlow2 6s linear infinite;
        }

        @keyframes circuitFlow1 {
            0% { left: 113px; top: 153px; }
            25% { left: 307px; top: 153px; }
            50% { left: 313px; top: 53px; }
            75% { left: 113px; top: 53px; }
            100% { left: 113px; top: 153px; }
        }

        @keyframes circuitFlow2 {
            0% { left: 313px; top: 153px; }
            25% { left: 313px; top: 53px; }
            50% { left: 113px; top: 53px; }
            75% { left: 113px; top: 153px; }
            100% { left: 313px; top: 153px; }
        }

        /* Current Intensity Control */
        .intensity-control {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 100, 148, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(0, 180, 216, 0.3);
        }

        .intensity-slider {
            width: 300px;
            height: 10px;
            background: linear-gradient(90deg, #74b9ff, #e17055);
            border-radius: 5px;
            margin: 20px auto;
            position: relative;
            cursor: pointer;
        }

        .intensity-thumb {
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Animation Control Buttons */
        .animation-controls {
            text-align: center;
            margin: 20px 0;
        }

        .animate-btn {
            background: linear-gradient(135deg, #4a9eff, #74b9ff);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .animate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.4);
        }

        .animate-btn:active {
            transform: translateY(0);
        }

        .stop-btn {
            background: linear-gradient(135deg, #e17055, #d63031);
        }

        .stop-btn:hover {
            background: linear-gradient(135deg, #d63031, #e17055);
        }

        /* Formula Display */
        .formula-box {
            background: rgba(74, 158, 255, 0.1);
            border: 2px solid rgba(74, 158, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 30px 0;
        }

        .formula-title {
            font-size: 1.3rem;
            color: #4a9eff;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .formula-equation {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: #74b9ff;
            margin: 15px 0;
            text-shadow: 0 0 10px rgba(116, 185, 255, 0.3);
        }

        .formula-explanation {
            font-size: 1rem;
            color: #ddd;
            margin-top: 15px;
            line-height: 1.6;
        }

        /* Current vs Electron Flow Comparison */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 40px 0;
        }

        .comparison-item {
            background: rgba(0, 5, 17, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(74, 158, 255, 0.3);
        }

        .comparison-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .conventional-current {
            border-color: rgba(225, 112, 85, 0.5);
        }

        .conventional-current .comparison-title {
            color: var(--current-color);
        }

        .electron-flow {
            border-color: rgba(116, 185, 255, 0.5);
        }

        .electron-flow .comparison-title {
            color: var(--electron-color);
        }

        /* Audio Indicator */
        .audio-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(74, 158, 255, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1001;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
        }

        .audio-indicator.active {
            opacity: 1;
            transform: translateX(0);
        }

        .audio-indicator::before {
            content: '🔊';
            margin-right: 8px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .concept-section {
                padding: 20px;
                margin: 30px 0;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .circuit-container {
                width: 100%;
                max-width: 400px;
                height: 250px;
            }
            
            .intensity-slider {
                width: 250px;
            }
        }

        /* Animation Enhancements */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-delay-1 { animation-delay: 0.2s; }
        .animate-delay-2 { animation-delay: 0.4s; }
        .animate-delay-3 { animation-delay: 0.6s; }
    </style>
</head>
<body>
    <!-- Cinematic Experience Container -->
    <div id="cinematic-experience">
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="active">
            <div class="loading-content">
                <div class="atom-spinner">
                    <div class="nucleus"></div>
                    <div class="electron-orbit orbit-1">
                        <div class="electron"></div>
                    </div>
                    <div class="electron-orbit orbit-2">
                        <div class="electron"></div>
                    </div>
                    <div class="electron-orbit orbit-3">
                        <div class="electron"></div>
                    </div>
                </div>
                <h1>Electrical Current</h1>
                <p>Loading current flow visualization...</p>
                <div class="loading-bar">
                    <div class="loading-progress"></div>
                </div>
            </div>
        </div>

        <!-- Fixed Elements -->
        <!-- Audio Control -->
        <div id="audio-control">
            <button id="mute-btn" class="control-btn">
                <span class="unmute-icon">🔊</span>
                <span class="mute-icon">🔇</span>
            </button>
        </div>

        <!-- Audio Indicator -->
        <div id="audio-indicator" class="audio-indicator">
            <span id="audio-text">Narrating...</span>
        </div>

        <!-- Interactive Visualization Background -->
        <div id="visualization-background">
            <div id="interactive-canvas" class="fullscreen-canvas"></div>
        </div>

        <!-- Main Content Container -->
        <div id="main-content">
            
            <!-- Hero Section -->
            <section class="cinematic-section active" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                <div class="section-background" style="background: radial-gradient(ellipse at center, #001a33 0%, #000511 60%, #000204 100%); opacity: 1;"></div>
                
                <div class="narrative-overlay" style="position: relative; z-index: 10; text-align: center;">
                    <div class="section-indicator" style="margin-bottom: 30px;">
                        <span class="section-number">⚡</span>
                        <span class="section-title">Electrical Current</span>
                    </div>
                    <div class="narrative-content">
                        <h1 style="font-size: 3.5rem; margin-bottom: 30px; background: linear-gradient(45deg, #4a9eff, #ff4a6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Flow of Electric Charge</h1>
                        <p class="narrative-text" style="font-size: 1.3rem; max-width: 800px; margin: 0 auto 40px;">
                            Electrical current is the flow of electric charge through a conductor. 
                            Let's visualize how electrons move through wires to create the electricity that powers our world.
                        </p>
                        <div class="equation-display" style="font-size: 1.5rem; color: #4a9eff;">I = Q/t</div>
                    </div>
                </div>

                <div class="scroll-hint" style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); text-align: center; color: #4a9eff; animation: bounce 2s infinite;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">↓</div>
                    <p>Scroll to explore electrical current</p>
                </div>
            </section>

            <!-- Main Educational Content -->
            <div class="illustration-container">

                <!-- Section 1: What is Electrical Current? -->
                <div class="concept-section fade-in">
                    <h2 class="section-title">What is Electrical Current?</h2>
                    
                    <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px; text-align: center;">
                        Electrical current is the flow of electric charge through a material. 
                        In most circuits, this means electrons moving through a conductor like copper wire.
                    </p>

                    <div class="formula-box">
                        <div class="formula-title">Current Formula</div>
                        <div class="formula-equation">I = Q/t</div>
                        <div class="formula-explanation">
                            Current (I) = Charge (Q) ÷ Time (t)
                            <br>• Current is measured in Amperes (A)
                            <br>• Charge is measured in Coulombs (C)
                            <br>• Time is measured in seconds (s)
                            <br>• 1 Ampere = 1 Coulomb per second
                        </div>
                    </div>

                    <div class="wire-container" id="basic-wire">
                        <div class="direction-label">Conventional Current Direction →</div>
                        <div class="current-arrow">→</div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                        <div class="electron"></div>
                    </div>

                    <div class="animation-controls">
                        <button class="animate-btn" onclick="startCurrentFlow()">▶ Start Current Flow</button>
                        <button class="animate-btn stop-btn" onclick="stopCurrentFlow()">⏹ Stop Current</button>
                    </div>

                    <p style="text-align: center; color: #ddd; margin-top: 20px; font-style: italic;">
                        Watch the blue electrons flowing from left to right through the conductor
                    </p>
                </div>

                <!-- Section 2: Current vs Electron Flow -->
                <div class="concept-section fade-in animate-delay-1">
                    <h2 class="section-title">Conventional Current vs Electron Flow</h2>
                    
                    <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px; text-align: center;">
                        There's an important distinction between the direction of conventional current and actual electron flow.
                    </p>

                    <div class="comparison-container">
                        <div class="comparison-item conventional-current">
                            <div class="comparison-title">Conventional Current</div>
                            <div style="text-align: center; margin: 20px 0;">
                                <div style="font-size: 2rem; color: var(--current-color); margin-bottom: 10px;">→</div>
                                <p style="color: #ddd; font-size: 0.9rem; line-height: 1.5;">
                                    Defined as positive charge flow from positive (+) to negative (−) terminal.
                                    This is the standard direction used in electrical engineering.
                                </p>
                            </div>
                        </div>
                        
                        <div class="comparison-item electron-flow">
                            <div class="comparison-title">Actual Electron Flow</div>
                            <div style="text-align: center; margin: 20px 0;">
                                <div style="font-size: 2rem; color: var(--electron-color); margin-bottom: 10px;">←</div>
                                <p style="color: #ddd; font-size: 0.9rem; line-height: 1.5;">
                                    Electrons actually flow from negative (−) to positive (+) terminal.
                                    Since electrons are negatively charged, they move opposite to conventional current.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div style="background: rgba(255, 193, 7, 0.1); border: 2px solid rgba(255, 193, 7, 0.3); border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center;">
                        <h4 style="color: #ffc107; margin-bottom: 10px;">Important Note:</h4>
                        <p style="margin: 0; color: #ddd;">
                            Both directions are correct! Conventional current direction is used for calculations and circuit analysis, 
                            while electron flow shows the actual physical movement of charge carriers.
                        </p>
                    </div>
                </div>

                <!-- Section 3: Current in a Circuit -->
                <div class="concept-section fade-in animate-delay-2">
                    <h2 class="section-title">Current in a Simple Circuit</h2>
                    
                    <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px; text-align: center;">
                        In a complete circuit, current flows from the battery through the wires and components, then back to the battery.
                    </p>

                    <div class="circuit-container">
                        <!-- Wire segments -->
                        <div class="circuit-wire horizontal-wire" style="top: 50px; left: 110px;"></div>
                        <div class="circuit-wire horizontal-wire" style="top: 150px; left: 110px;"></div>
                        <div class="circuit-wire vertical-wire" style="top: 50px; left: 310px;"></div>
                        <div class="circuit-wire vertical-wire" style="top: 50px; left: 110px;"></div>
                        
                        <!-- Components -->
                        <div class="battery"></div>
                        <div class="resistor"></div>
                        
                        <!-- Moving electrons -->
                        <div class="circuit-electron path1"></div>
                        <div class="circuit-electron path2"></div>
                    </div>

                    <div class="animation-controls">
                        <button class="animate-btn" onclick="startCircuitFlow()">▶ Animate Circuit Current</button>
                        <button class="animate-btn stop-btn" onclick="stopCircuitFlow()">⏹ Stop Circuit</button>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                        <div style="text-align: center; padding: 15px; background: rgba(0, 180, 216, 0.1); border-radius: 10px;">
                            <div style="font-size: 1.5rem; color: #00b4d8; margin-bottom: 10px;">🔋</div>
                            <h4 style="color: #00b4d8; margin-bottom: 10px;">Battery</h4>
                            <p style="color: #ddd; font-size: 0.9rem;">Provides electrical energy and creates potential difference</p>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(214, 48, 49, 0.1); border-radius: 10px;">
                            <div style="font-size: 1.5rem; color: #d63031; margin-bottom: 10px;">⚡</div>
                            <h4 style="color: #d63031; margin-bottom: 10px;">Resistor</h4>
                            <p style="color: #ddd; font-size: 0.9rem;">Opposes current flow and converts electrical energy to heat</p>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(255, 234, 167, 0.1); border-radius: 10px;">
                            <div style="font-size: 1.5rem; color: #ffeaa7; margin-bottom: 10px;">🔌</div>
                            <h4 style="color: #ffeaa7; margin-bottom: 10px;">Conductor</h4>
                            <p style="color: #ddd; font-size: 0.9rem;">Allows electrons to flow easily through the circuit</p>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Current Intensity -->
                <div class="concept-section fade-in animate-delay-3">
                    <h2 class="section-title">Current Intensity Control</h2>
                    
                    <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 30px; text-align: center;">
                        The intensity of electrical current determines how many electrons flow per second. 
                        More current means more electrons flowing through the conductor.
                    </p>

                    <div class="intensity-control">
                        <h4 style="color: #4a9eff; margin-bottom: 20px;">Adjust Current Intensity</h4>
                        <div class="intensity-slider" onclick="adjustIntensity(event)">
                            <div class="intensity-thumb" id="intensity-thumb"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #ddd;">
                            <span>Low Current (0.1 A)</span>
                            <span>High Current (5.0 A)</span>
                        </div>
                        <div id="current-display" style="font-size: 1.2rem; color: #4a9eff; margin-top: 15px; font-weight: 600;">
                            Current: 2.5 A
                        </div>
                    </div>

                    <div class="wire-container" id="intensity-wire">
                        <div class="direction-label">Current Intensity Demo</div>
                        <div class="current-arrow">→</div>
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Ohm's Law</div>
                        <div class="formula-equation">V = I × R</div>
                        <div class="formula-explanation">
                            Voltage (V) = Current (I) × Resistance (R)
                            <br>• Voltage increases current (if resistance stays the same)
                            <br>• Resistance opposes current flow
                            <br>• Higher voltage = more current
                            <br>• Higher resistance = less current
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Enhanced Script -->
    <script>
        // Initialize the experience
        window.addEventListener('load', () => {
            setTimeout(() => {
                hideLoadingScreen();
                initializeAnimations();
                initializeAudio();
                setupIntensityControl();
            }, 2000);
        });

        // Audio Control Variables
        let audioEnabled = true;
        let currentAudio = null;
        let speechSynthesis = window.speechSynthesis;
        let currentFlowActive = false;
        let circuitFlowActive = false;

        // Audio Content Scripts
        const audioScripts = {
            intro: "Welcome to understanding electrical current. Current is the flow of electric charge through a conductor. We'll visualize how electrons move through wires to create electricity.",
            basicCurrent: "Electrical current is measured in amperes and represents the amount of charge flowing per second. One ampere equals one coulomb of charge flowing per second.",
            currentVsElectron: "There's an important distinction between conventional current and electron flow. Conventional current flows from positive to negative, while electrons actually move from negative to positive.",
            circuit: "In a complete circuit, electrons flow from the battery through wires and components, then return to the battery. The battery provides energy to push electrons through the circuit.",
            intensity: "Current intensity determines how many electrons flow per second. Higher current means more electrons moving through the conductor, which requires more voltage or less resistance."
        };

        function initializeAudio() {
            const audioObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && audioEnabled) {
                        const section = entry.target;
                        playAudioForSection(section);
                    }
                });
            }, { threshold: 0.5 });

            const sections = document.querySelectorAll('.concept-section');
            sections.forEach(section => audioObserver.observe(section));

            setTimeout(() => {
                if (audioEnabled) {
                    speakText(audioScripts.intro);
                }
            }, 3000);
        }

        function playAudioForSection(section) {
            const sectionTitle = section.querySelector('.section-title');
            if (!sectionTitle) return;

            const title = sectionTitle.textContent;
            stopCurrentAudio();

            if (title.includes('What is Electrical Current')) {
                speakText(audioScripts.basicCurrent);
            } else if (title.includes('Conventional Current vs Electron Flow')) {
                speakText(audioScripts.currentVsElectron);
            } else if (title.includes('Current in a Simple Circuit')) {
                speakText(audioScripts.circuit);
            } else if (title.includes('Current Intensity')) {
                speakText(audioScripts.intensity);
            }
        }

        function speakText(text) {
            if (!audioEnabled || !speechSynthesis) return;

            stopCurrentAudio();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;
            
            let voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    voices = speechSynthesis.getVoices();
                    setVoiceAndSpeak(utterance, voices, text);
                });
            } else {
                setVoiceAndSpeak(utterance, voices, text);
            }
        }

        function setVoiceAndSpeak(utterance, voices, text) {
            const preferredVoice = voices.find(voice => 
                voice.name.includes('Samantha') || 
                voice.name.includes('Karen') || 
                voice.name.includes('Susan') ||
                voice.name.includes('Alex') ||
                (voice.lang.startsWith('en-') && voice.name.includes('Female'))
            ) || voices.find(voice => voice.lang.startsWith('en-')) || voices[0];
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }

            utterance.onstart = () => showAudioIndicator(text);
            utterance.onend = () => {
                hideAudioIndicator();
                currentAudio = null;
            };
            utterance.onerror = () => {
                hideAudioIndicator();
                currentAudio = null;
            };

            currentAudio = utterance;
            speechSynthesis.speak(utterance);
        }

        function showAudioIndicator(text) {
            const indicator = document.getElementById('audio-indicator');
            const textElement = document.getElementById('audio-text');
            
            if (indicator && textElement) {
                const shortText = text.length > 50 ? text.substring(0, 50) + '...' : text;
                textElement.textContent = shortText;
                indicator.classList.add('active');
            }
        }

        function hideAudioIndicator() {
            const indicator = document.getElementById('audio-indicator');
            if (indicator) {
                indicator.classList.remove('active');
            }
        }

        function stopCurrentAudio() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            hideAudioIndicator();
            currentAudio = null;
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.classList.remove('active');
        }

        function initializeAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fade-in').forEach(el => {
                el.style.animationPlayState = 'paused';
                observer.observe(el);
            });
        }

        // Current Flow Animation Controls
        function startCurrentFlow() {
            currentFlowActive = true;
            const electrons = document.querySelectorAll('#basic-wire .electron');
            electrons.forEach(electron => {
                electron.style.animationPlayState = 'running';
            });

            if (audioEnabled) {
                speakText("Watch the electrons flowing through the conductor from left to right. This represents electrical current - the movement of electric charge through a material.");
            }
        }

        function stopCurrentFlow() {
            currentFlowActive = false;
            const electrons = document.querySelectorAll('#basic-wire .electron');
            electrons.forEach(electron => {
                electron.style.animationPlayState = 'paused';
            });
        }

        function startCircuitFlow() {
            circuitFlowActive = true;
            const circuitElectrons = document.querySelectorAll('.circuit-electron');
            circuitElectrons.forEach(electron => {
                electron.style.animationPlayState = 'running';
            });

            if (audioEnabled) {
                speakText("In this circuit, electrons flow from the negative terminal of the battery, through the resistor and wires, and back to the positive terminal, completing the circuit.");
            }
        }

        function stopCircuitFlow() {
            circuitFlowActive = false;
            const circuitElectrons = document.querySelectorAll('.circuit-electron');
            circuitElectrons.forEach(electron => {
                electron.style.animationPlayState = 'paused';
            });
        }

        // Current Intensity Control
        function setupIntensityControl() {
            const slider = document.querySelector('.intensity-slider');
            const thumb = document.getElementById('intensity-thumb');
            let isDragging = false;

            thumb.addEventListener('mousedown', (e) => {
                isDragging = true;
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                    document.removeEventListener('mousemove', handleDrag);
                });
            });

            function handleDrag(e) {
                if (!isDragging) return;
                
                const rect = slider.getBoundingClientRect();
                let percentage = (e.clientX - rect.left) / rect.width;
                percentage = Math.max(0, Math.min(1, percentage));
                
                thumb.style.left = `${percentage * 100}%`;
                updateCurrentDisplay(percentage);
                updateElectronFlow(percentage);
            }
        }

        function adjustIntensity(event) {
            const slider = event.currentTarget;
            const rect = slider.getBoundingClientRect();
            const percentage = (event.clientX - rect.left) / rect.width;
            const clampedPercentage = Math.max(0, Math.min(1, percentage));
            
            const thumb = document.getElementById('intensity-thumb');
            thumb.style.left = `${clampedPercentage * 100}%`;
            updateCurrentDisplay(clampedPercentage);
            updateElectronFlow(clampedPercentage);
        }

        function updateCurrentDisplay(percentage) {
            const current = (0.1 + (4.9 * percentage)).toFixed(1);
            document.getElementById('current-display').textContent = `Current: ${current} A`;
        }

        function updateElectronFlow(percentage) {
            // Clear existing electrons
            const intensityWire = document.getElementById('intensity-wire');
            const existingElectrons = intensityWire.querySelectorAll('.electron');
            existingElectrons.forEach(electron => electron.remove());

            // Add new electrons based on intensity
            const electronCount = Math.max(1, Math.floor(1 + (percentage * 12)));
            const animationSpeed = Math.max(1, 5 - (percentage * 3));

            for (let i = 0; i < electronCount; i++) {
                const electron = document.createElement('div');
                electron.className = 'electron';
                electron.style.animationDuration = `${animationSpeed}s`;
                electron.style.animationDelay = `${(i * animationSpeed) / electronCount}s`;
                intensityWire.appendChild(electron);
            }
        }

        // Audio control
        document.getElementById('mute-btn')?.addEventListener('click', function() {
            this.classList.toggle('muted');
            audioEnabled = !audioEnabled;
            
            if (!audioEnabled) {
                stopCurrentAudio();
            }
        });

        // Smooth scrolling
        document.addEventListener('wheel', (e) => {
            if (Math.abs(e.deltaY) > 50) {
                e.preventDefault();
                const scrollAmount = e.deltaY > 0 ? 100 : -100;
                window.scrollBy({
                    top: scrollAmount,
                    behavior: 'smooth'
                });
            }
        });

        // Bounce animation for scroll hint
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 100% { transform: translateX(-50%) translateY(0); }
                50% { transform: translateX(-50%) translateY(-10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 